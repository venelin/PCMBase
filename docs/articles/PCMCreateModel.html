<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating a Custom Model in the PCMBase Framework • PCMBase</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creating a Custom Model in the PCMBase Framework">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-129563006-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129563006-3');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PCMBase</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/PCMBase.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/PCMParam.html">The PCMBase Parametrization API</a>
    </li>
    <li>
      <a href="../articles/PCMCreateModel.html">Creating a Custom Model in the PCMBase Framework</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Creating a Custom Model in the PCMBase Framework</h1>
                        <h4 class="author">Krzysztof Bartoszek</h4>
            
            <h4 class="date">2019-04-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/venelin/PCMBase/blob/master/R/vignettes/PCMCreateModel.Rmd"><code>R/vignettes/PCMCreateModel.Rmd</code></a></small>
      <div class="hidden name"><code>PCMCreateModel.Rmd</code></div>

    </div>

    
    
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span>opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">echo =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(abind)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(PCMBase)</code></pre></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The PCMBase package is designed as a computational engine to calculate the likelihood for a user specified model evolving on a phylogenetic tree. The package comes with some pre-implemented models, e.g. Brownian Motion or Ornstein-Uhlenbeck, both allowing for multivariate correlated evolution. However, the mathematical theory behind the method for calculating the likelihood (Mitov et. al. 2018) is not limited to these two models. In fact any stochastic process that belongs to the so-called GLInv family of models is implementable in PCMBase. From a mathematical perspective one needs to be able to implement functions that calculate the compound parameters <span class="math inline">\(\vec{\omega}\)</span>, <span class="math inline">\(\mathbf{\Phi}\)</span> and <span class="math inline">\(\mathbf{V}\)</span>. Furthermore, from the implementation side one has to be able to handle the model defining parameters (default values, allowable parametrizations, etc.).</p>
<p>PCMBase’s interface is based on the S3 object system (an excellent introduction by Hadley Wickham is available at <a href="http://adv-r.had.co.nz/S3.html" class="uri">http://adv-r.had.co.nz/S3.html</a>). Each implemented model will be an S3 object and below we will describe how a user can implement a new model class by themselves.</p>
</div>
<div id="brownian-motion-with-drift" class="section level1">
<h1 class="hasAnchor">
<a href="#brownian-motion-with-drift" class="anchor"></a>Brownian motion with drift</h1>
<p>We will show how to create one’s own model class with the example of Brownian motion with drift. The model is a simple generalization of the Brownian motion model by including a deterministic drift. It is defined by the stochastic differential equation (SDE) <span class="math display">\[d\vec{X}(t) = \vec{h} dt + \Sigma_{x} d W(t),\]</span> where <span class="math inline">\(W(t)\)</span> is the standard Wiener process. Setting <span class="math inline">\(\vec{h}=\vec{0}\)</span> reduces the model to the Brownian motion process. The expectation of the process is <span class="math inline">\(E[\vec{X}(t)] = \vec{X}(0)+t\vec{h}\)</span> and the variance <span class="math inline">\(Var[\vec{X}(t)] = t\Sigma_{x}\Sigma_{x}^{T}\)</span>. Based on this we can calculate the the compound parameters <span class="math inline">\(\vec{\omega}\)</span>, <span class="math inline">\(\mathbf{\Phi}\)</span> and <span class="math inline">\(\mathbf{V}\)</span> defining the model in the GLInv family (Eq. 30, Mitov et. al. 2018) <span class="math display">\[
\vec{\omega} = \vec{h}t,
\]</span> <span class="math display">\[
\mathbf{\Phi} = \mathbf{I},
\]</span> <span class="math display">\[
\mathbf{V} = \Sigma_{x}\Sigma_{x}^{T}t.
\]</span> In the context of the PCM class setup we will actually have <span class="math display">\[
\mathbf{V} = \Sigma_{x}\Sigma_{x}^{T}t +  \Sigma_{e}\Sigma_{e}^{T}
\]</span> as these compound parameters are calculated at the end of branches. The package allows for normally distributed <span class="math inline">\(\vec{0}\)</span> mean, <em>{e}</em>{e}^{T} variance jumps at the end of a branch.</p>
</div>
<div id="a-pcmbase-class-for-brownian-motion-with-drift" class="section level1">
<h1 class="hasAnchor">
<a href="#a-pcmbase-class-for-brownian-motion-with-drift" class="anchor"></a>A PCMBase class for Brownian motion with drift</h1>
<p>We will now show how to implement the Brownian motion with drift model in a class called “BM_drift that inherits from the”GaussianPCM" and “PCM” classes. It is easiest if one takes an .R file from the PCMBase package that already implements a model class and then modifies it accordingly. We will work here with the BM.R file (that implements the BM model). We need to redefine the generic functions of the “PCM” and “GaussianPCM” classes to suit the Brownian motion with drift model. We remind the reader that the function name is composed of two parts separated by the dot. The first part is the generic function, the second the name of the class in which it is implemented. For example <code>PCMCond.BM_drift</code> is the <code>PCMCond</code> function’s instance in the “BM_drift” class.</p>
<ul>
<li>
<code>PCMParentClasses.BM_drift</code> : function returning the parental classes. of “BM_drift”:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PCMParentClasses.BM_drift &lt;-<span class="st"> </span><span class="cf">function</span>(model) {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"GaussianPCM"</span>, <span class="st">"PCM"</span>)
}</code></pre></div>
<ul>
<li>
<code>PCMDescribe.BM_drift</code> : function returning a custom description of the model.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PCMDescribe.BM_drift &lt;-<span class="st"> </span><span class="cf">function</span>(model, ...) {
  <span class="st">"Brownian motion model with drift"</span>
}</code></pre></div>
<ul>
<li>
<code>PCMCond.BM_drift</code> : the key function when implementing a new model class. This function returns a list with functions for calculating the <span class="math inline">\(\vec{\omega}\)</span>, <span class="math inline">\(\mathbf{\Phi}\)</span> and <span class="math inline">\(\mathbf{V}\)</span> compound parameters that define the conditional distribution of the daughter node given the value of the trait at its parent node (<span class="math inline">\(\vec{x}_{parent}\)</span>. Following Mitov et. al. (2018) we know that in the GLInv family a daughter node conditional on its parent is normally distributed with expectation <span class="math inline">\(\vec{\omega}+\mathbf{\Phi}\vec{x}_{parent}\)</span> and variance-covariance matrix <span class="math inline">\(\mathbf{V}\)</span>. In particular the <span class="math inline">\(\vec{\omega}\)</span>, <span class="math inline">\(\mathbf{\Phi}\)</span> and <span class="math inline">\(\mathbf{V}\)</span> compound parameters can depend on time (i.e. the length of the branch from the parental to the daughter node). In the case of the BM with drift model the <span class="math inline">\(\vec{\omega}=t\cdot \vec{h}\)</span>, <span class="math inline">\(\mathbf{\Phi}\)</span> is the identity matrix and <span class="math inline">\(\mathbf{V}\)</span> is the same as in the Brownian motion model (which in itself is a limit of the OU model, hence the reuse of the PCMConcVOU function).</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PCMCond.BM_drift &lt;-<span class="st"> </span><span class="cf">function</span>(
  tree, model, <span class="dt">r =</span> <span class="dv">1</span>, <span class="dt">metaI =</span> <span class="kw"><a href="../reference/PCMInfo.html">PCMInfo</a></span>(<span class="ot">NULL</span>, tree, model, <span class="dt">verbose =</span> verbose),
  <span class="dt">verbose=</span><span class="ot">FALSE</span>) {

  
  Sigma_x &lt;-<span class="st"> </span><span class="cf">if</span>(<span class="kw"><a href="../reference/PCMParamType.html">is.Global</a></span>(model<span class="op">$</span>Sigma_x)){<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(model<span class="op">$</span>Sigma_x)}
         <span class="cf">else</span>{<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(model<span class="op">$</span>Sigma_x[,, r])}
  Sigma &lt;-<span class="st"> </span>Sigma_x <span class="op">%*%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(Sigma_x)
  <span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NULL">is.null</a></span>(model<span class="op">$</span>Sigmae_x)) {
    Sigmae_x &lt;-<span class="st"> </span><span class="cf">if</span>(<span class="kw"><a href="../reference/PCMParamType.html">is.Global</a></span>(model<span class="op">$</span>Sigmae_x)){<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(model<span class="op">$</span>Sigmae_x)}
        <span class="cf">else</span>{<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(model<span class="op">$</span>Sigmae_x[,,r])}
    Sigmae &lt;-<span class="st"> </span>Sigmae_x <span class="op">%*%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(Sigmae_x)
  } <span class="cf">else</span> {
    Sigmae &lt;-<span class="st"> </span><span class="ot">NULL</span>
  }

  <span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NULL">is.null</a></span>(model<span class="op">$</span>h_drift)) { 
    h_drift &lt;-<span class="st"> </span><span class="cf">if</span>(<span class="kw"><a href="../reference/PCMParamType.html">is.Global</a></span>(model<span class="op">$</span>h_drift)) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">as.vector</a></span>(model<span class="op">$</span>h_drift) <span class="cf">else</span> model<span class="op">$</span>h_drift[, r]
  }<span class="cf">else</span>{
    h_drift &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">0</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(Sigma_x))
  }

  V &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PCMCondVOU.html">PCMCondVOU</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(Sigma), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(Sigma)), Sigma, Sigmae)
  omega &lt;-<span class="st"> </span><span class="cf">function</span>(t, edgeIndex, metaI) {
    t<span class="op">*</span>h_drift
  }
  Phi &lt;-<span class="st"> </span><span class="cf">function</span>(t, edgeIndex, metaI, <span class="dt">e_Ht =</span> <span class="ot">NULL</span>) {
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diag">diag</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(Sigma))
  }
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">omega =</span> omega, <span class="dt">Phi =</span> Phi, <span class="dt">V =</span> V)
}</code></pre></div>
<ul>
<li>
<code>PCMDescribeParameters.BM_drift</code> : a function that returns a list with a custom description of each model parameter.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PCMDescribeParameters.BM_drift &lt;-<span class="st"> </span><span class="cf">function</span>(model, ...) {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
    <span class="dt">X0 =</span> <span class="st">"trait values at the root"</span>,
    <span class="dt">h_drift =</span> <span class="st">"drift vector modifying the expectation"</span>,
    <span class="dt">Sigma_x =</span> <span class="st">"Cholesky factor of the unit-time variance rate"</span>,
    <span class="dt">Sigmae_x =</span> <span class="st">"Cholesky factor of the non-heritable variance </span>
<span class="st">        or the variance of the measurement error"</span>)
}</code></pre></div>
<ul>
<li>
<code>PCMListParameterizations.BM_drift</code> : a function that returns all possible parametrizations for the implemented model class. These parametrizations correspond to how each parameter defining the model can be parametrized. For a detailed description of how matrices can be parametrized please see Bartoszek (2011), Bartoszek et. al. (2012) or the matrixparametrizations.R file in the mvSLOUCH or PCMBase R packages. Probably from the perspective of just calculating the likelihood given some parameters this function does not seem that useful. However, one should not forget that PCMBase is designed to be a computational engine providing the likelihood that will be optimized over some other code. Here, <span class="math inline">\(\vec{X}(0)\)</span> and <span class="math inline">\(\vec{h}\)</span> are vectors (i.e. “VectorParameter”). The “_AllEqual" parametrization means all the entries of the vector should be equal. “_Global" means that it is the same for all regimes (notice that <span class="math inline">\(\vec{X}(0)\)</span> is the value at the root, so it has to be common for all), “_Omitted" means not present (for <span class="math inline">\(\vec{h}\)</span> this means that the model will correspond to a Brownian motion with <span class="math inline">\(0\)</span> drift). Finally “_Fixed" means that the parameter is “known”, i.e. it is not to be optimized over. Matrix parametrizations are more involved. For example one will not optimize over a covariance matrix but e.g. over its Cholesky decomposition. Here we just have the <span class="math inline">\(\Sigma_{x}\)</span> and <span class="math inline">\(\Sigma_{e}\)</span> matrices (however see the “OU” class for more involved cases with the <span class="math inline">\(H\)</span> matrix). Here, these two matrices can be either upper triangular, diagonal or diagonal with a constant value on the diagonal. Both of them enter the likelihood (through <span class="math inline">\(\mathbf{V}\)</span>) as a product of themselves and their transposition i.e. <span class="math inline">\(SS^{T}\)</span> so decomposition into a triangular matrix (with non-negative diagonal) suffices for unique identification of the matrix. Notice that if <span class="math inline">\(S\)</span> is of dimension <span class="math inline">\(k\times k\)</span>, then <span class="math inline">\(SS^{T}\)</span> has <span class="math inline">\(k^{2}\)</span> potentially non-zero elements while its triangular decomposition only <span class="math inline">\(k(k+1)/2\)</span> A detailed description of the different possible parametrizations is given in the help file for PCMParam.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PCMListParameterizations.BM_drift &lt;-<span class="st"> </span><span class="cf">function</span>(model, ...) {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
    <span class="dt">X0 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VectorParameter"</span>, <span class="st">"_Global"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VectorParameter"</span>, <span class="st">"_Fixed"</span>, <span class="st">"_Global"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VectorParameter"</span>, <span class="st">"_AllEqual"</span>, <span class="st">"_Global"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VectorParameter"</span>, <span class="st">"_Omitted"</span>)),
    <span class="dt">h_drift =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(     
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VectorParameter"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VectorParameter"</span>, <span class="st">"_Fixed"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VectorParameter"</span>, <span class="st">"_AllEqual"</span>),
       <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VectorParameter"</span>, <span class="st">"_Omitted"</span>)),
       
    <span class="dt">Sigma_x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_UpperTriangularWithDiagonal"</span>, <span class="st">"_WithNonNegativeDiagonal"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_Diagonal"</span>, <span class="st">"_WithNonNegativeDiagonal"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_ScalarDiagonal"</span>, <span class="st">"_WithNonNegativeDiagonal"</span>)),

    <span class="dt">Sigmae_x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_UpperTriangularWithDiagonal"</span>, <span class="st">"_WithNonNegativeDiagonal"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_Diagonal"</span>, <span class="st">"_WithNonNegativeDiagonal"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_ScalarDiagonal"</span>, <span class="st">"_WithNonNegativeDiagonal"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_UpperTriangularWithDiagonal"</span>, <span class="st">"_WithNonNegativeDiagonal"</span>, <span class="st">"_Global"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_Diagonal"</span>, <span class="st">"_WithNonNegativeDiagonal"</span>, <span class="st">"_Global"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_ScalarDiagonal"</span>, <span class="st">"_WithNonNegativeDiagonal"</span>, <span class="st">"_Global"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_Omitted"</span>))
  )
}</code></pre></div>
<ul>
<li>
<code>PCMListDefaultParameterizations.BM_drift</code> : this function is optional to define but can be useful if only a subset of the parametrizations defined in the PCMListParametrizations function will actually be used in practise.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PCMListDefaultParameterizations.BM_drift &lt;-<span class="st"> </span><span class="cf">function</span>(model, ...) {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
    <span class="dt">X0 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VectorParameter"</span>, <span class="st">"_Global"</span>),
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VectorParameter"</span>, <span class="st">"_Omitted"</span>)
    ),
    <span class="dt">h_drift =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(     
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VectorParameter"</span>)),
       
    <span class="dt">Sigma_x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_UpperTriangularWithDiagonal"</span>, <span class="st">"_WithNonNegativeDiagonal"</span>),
        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_Diagonal"</span>, <span class="st">"_WithNonNegativeDiagonal"</span>),
        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_ScalarDiagonal"</span>, <span class="st">"_WithNonNegativeDiagonal"</span>)
      ),

    <span class="dt">Sigmae_x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MatrixParameter"</span>, <span class="st">"_Omitted"</span>))
  )
}</code></pre></div>
<ul>
<li>
<code>PCMSpecify.BM_drift</code> : generate default model parameters. Notice that here we obtain a singular model with 0 mean and 0 variance.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PCMSpecify.BM_drift &lt;-<span class="st"> </span><span class="cf">function</span>(model, ...) {
  spec &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
    <span class="dt">X0 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/structure">structure</a></span>(<span class="fl">0.0</span>, <span class="dt">class =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'VectorParameter'</span>, <span class="st">'_Global'</span>),
                   <span class="dt">description =</span> <span class="st">'trait values at the root'</span>),
    <span class="dt">h_drift =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/structure">structure</a></span>(<span class="fl">0.0</span>, <span class="dt">class =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'VectorParameter'</span>),
                   <span class="dt">description =</span> <span class="st">'drift vector modifying the expectation'</span>),
    <span class="dt">Sigma_x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/structure">structure</a></span>(<span class="fl">0.0</span>, <span class="dt">class =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'MatrixParameter'</span>, <span class="st">'_UpperTriangularWithDiagonal'</span>, 
                    <span class="st">'_WithNonNegativeDiagonal'</span>),
                        <span class="dt">description =</span> <span class="st">'Cholesky factor of the unit-time variance rate'</span>),
    <span class="dt">Sigmae_x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/structure">structure</a></span>(<span class="fl">0.0</span>, <span class="dt">class =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'MatrixParameter'</span>, <span class="st">'_UpperTriangularWithDiagonal'</span>,
                    <span class="st">'_WithNonNegativeDiagonal'</span>),
                         <span class="dt">description =</span> <span class="st">'Cholesky factor of the non-heritable variance </span>
<span class="st">                                or the variance of the measurement error'</span>))
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attributes">attributes</a></span>(spec) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attributes">attributes</a></span>(model)
  <span class="cf">if</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NULL">is.null</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(spec))) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(spec) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'X0'</span>, <span class="st">'h_drift'</span>, <span class="st">'Sigma_x'</span>, <span class="st">'Sigmae_x'</span>)
  <span class="cf">if</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/any">any</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(spec, is.Transformable))) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(spec) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(spec), <span class="st">'_Transformable'</span>)
  spec
}</code></pre></div>
</div>
<div id="example-run" class="section level1">
<h1 class="hasAnchor">
<a href="#example-run" class="anchor"></a>Example run</h1>
<p>Now that we have defined all the code necessary for the class let us demonstrate it. After running all the above code defining the “BM_drift” class we create a model instance. We do this for a two regimes model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">X0 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">1</span>) ## root state
  
## in regime a traits evolve independently
a.Sigma_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">1.6</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.0</span>, <span class="fl">2.4</span>, <span class="fl">0.0</span>),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">2.0</span>))
## no jumps at the end of a branch
a.Sigmae_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>))
a.h_drift&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)

## in regime b evolution is correlated
b.Sigma_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">1.6</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.0</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">2.0</span>))
## no jumps at the end of a branch
b.Sigmae_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>))
b.h_drift&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)

Sigma_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/abind/topics/abind">abind</a></span>(a.Sigma_x, b.Sigma_x, <span class="dt">along=</span><span class="dv">3</span>, <span class="dt">new.names=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">x=</span><span class="ot">NULL</span>,<span class="dt">y=</span><span class="ot">NULL</span>,<span class="dt">regime=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'a'</span>,<span class="st">'b'</span>)))
Sigmae_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/abind/topics/abind">abind</a></span>(a.Sigmae_x,b.Sigmae_x,<span class="dt">along=</span><span class="dv">3</span>,<span class="dt">new.names=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">x=</span><span class="ot">NULL</span>,<span class="dt">y=</span><span class="ot">NULL</span>,<span class="dt">regime=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'a'</span>,<span class="st">'b'</span>)))
h_drift &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/abind/topics/abind">abind</a></span>(a.h_drift, b.h_drift, <span class="dt">along=</span><span class="dv">2</span>, <span class="dt">new.names=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">xy=</span><span class="ot">NULL</span>, <span class="dt">regime=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'a'</span>,<span class="st">'b'</span>)))

PCMBase_model_BM_drift &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PCM.html">PCM</a></span>(<span class="st">"BM_drift"</span>, <span class="dt">k =</span> <span class="dv">3</span>, <span class="dt">regimes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"a"</span>, <span class="st">"b"</span>),
<span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">X0 =</span> X0,<span class="dt">h_drift =</span> h_drift[,,<span class="dt">drop=</span><span class="ot">FALSE</span>],
<span class="dt">Sigma_x =</span> Sigma_x[,,,<span class="dt">drop=</span><span class="ot">FALSE</span>],<span class="dt">Sigmae_x =</span> Sigmae_x[,,,<span class="dt">drop=</span><span class="ot">FALSE</span>]))</code></pre></div>
<p>Now we simulate a random phylogeny (here pure birth tree with unit speciation rate conditioned on <span class="math inline">\(30\)</span> tips). Furthermore, we randomly paint the two regimes, “a” and “b” on the tips of the tree. Then, we use mvSLOUCH’s (modified from slouch, Hansen et. al. 2008, to work with phylo format trees) Fitch algorithm to paint the regimes on the internal branches of the tree. It is worth pointing out that the Fitch algorithm is only one option and the user should explore other possibilities depending on the problem.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">12345</span>, <span class="dt">kind =</span> <span class="st">"Mersenne-Twister"</span>, <span class="dt">normal.kind =</span> <span class="st">"Inversion"</span>) ## set a random seed
N&lt;-<span class="dv">30</span> ## number or tip species
phyltree&lt;-ape<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ape/topics/rtree">rcoal</a></span>(<span class="dt">n=</span>N)

v_current_regimes&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"a"</span>,<span class="st">"b"</span>),<span class="dv">30</span>,<span class="dt">replace=</span><span class="ot">TRUE</span>)
v_branch_regimes&lt;-mvSLOUCH<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/mvSLOUCH/topics/fitch.mvsl">fitch.mvsl</a></span>(phyltree,v_current_regimes)<span class="op">$</span>branch_regimes</code></pre></div>
<pre><code>## There is an ambiguity at the root node, as given below</code></pre>
<pre><code>## [1] "b" "a"</code></pre>
<pre><code>## Set this to one of the ambiguous states using root = state (state needs to be in quotation marks) in the function call before attempting the deltran or acctran reconstructions</code></pre>
<pre><code>## The number of ambiguous nodes are:</code></pre>
<pre><code>## [1] 5</code></pre>
<pre><code>##  and they are at nodes:</code></pre>
<pre><code>## [1]  1  2  5 22 23</code></pre>
<pre><code>## Try deltran OR acctran = TRUE in the function call in order to implement a delayed or accelerated character transformation</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v_ambiguous&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(v_branch_regimes<span class="op">==</span><span class="st">"ambiguous"</span>)
<span class="cf">if</span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(v_ambiguous)<span class="op">&gt;</span><span class="dv">0</span>){
    v_branch_regimes[v_ambiguous]&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which.min">which.max</a></span>((<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(v_branch_regimes[<span class="op">-</span>v_ambiguous]))))
}
## some branches may have "ambiguous" assigned to them due to how the implementation of 
## Fitch's algorithm works. These branches need to have the regimes set manually. 
## We do this according to the maximum rule but in a real analysis this would have to be 
## done based on a careful analysis of the biological system under study.
phyltree&lt;-<span class="kw"><a href="../reference/PCMTreeSetRegimesForEdges.html">PCMTreeSetRegimesForEdges</a></span>(phyltree, v_branch_regimes,<span class="ot">FALSE</span>) </code></pre></div>
<p>We simulate the traits using PCMBase’s functionality.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mData&lt;-<span class="kw"><a href="../reference/PCMSim.html">PCMSim</a></span>(phyltree, PCMBase_model_BM_drift, X0)[,<span class="dv">1</span><span class="op">:</span>N] ## we only want the tip data
## <span class="al">NOTE</span> that observations from different species are in the columns NOT in the rows as 
## in other software</code></pre></div>
<p>Finally we calculate the likelihood under the BM with drift model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">log_lik&lt;-<span class="st"> </span><span class="kw"><a href="../reference/PCMLik.html">PCMLik</a></span>(mData, phyltree, PCMBase_model_BM_drift)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(log_lik[<span class="dv">1</span>]) ## we just want to print the log-likelihood without the attributes</code></pre></div>
<pre><code>## [1] -47.15921</code></pre>
<p>If PCMBase is used as a computational engine for some inference package, then the above code can be one way of obtaining the likelihood under a “GaussianPCM” model object. However, in such a setup it is more recommended to use the mechanism of creating a likelihood function for a particular dataset through PCMCreateLikelihood. This will speed up the calculations as it avoids traversing the tree every time the likelihood value is required. One just needs to update the parameters to obtain a new likelihood value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## create an vector of appropriate length to store the vectorized model parameters
v_param &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/double">double</a></span>(<span class="kw"><a href="../reference/PCMParamCount.html">PCMParamCount</a></span>(PCMBase_model_BM_drift))

<span class="co"># load the current model parameters into param</span>
<span class="kw"><a href="../reference/PCMParamLoadOrStore.html">PCMParamLoadOrStore</a></span>(PCMBase_model_BM_drift, v_param, <span class="dt">offset=</span><span class="dv">0</span>, <span class="dt">load=</span><span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## [1] 33</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(v_param)</code></pre></div>
<pre><code>##  [1] 5.0 2.0 1.0 4.0 5.0 6.0 1.0 2.0 3.0 1.6 0.0 2.4 0.0 0.0 2.0 1.6 0.3
## [18] 0.3 0.3 0.4 2.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## now create a likelihood function for the particular model and observed data
likFun &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PCMCreateLikelihood.html">PCMCreateLikelihood</a></span>(mData, phyltree, PCMBase_model_BM_drift)

log_lik_from_likFun&lt;-<span class="kw">likFun</span>(v_param)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(log_lik_from_likFun[<span class="dv">1</span>])</code></pre></div>
<pre><code>## [1] -47.15921</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(log_lik_from_likFun[<span class="dv">1</span>]<span class="op">==</span>log_lik[<span class="dv">1</span>])</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># modify slightly the model parameters</span>
v_param_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/jitter">jitter</a></span>(v_param)

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(v_param_<span class="dv">2</span>)</code></pre></div>
<pre><code>##  [1]  4.988561454  1.989858580  0.984932882  4.011415487  5.010456952
##  [6]  5.987847998  1.015901196  2.003816074  2.997723418  1.591956812
## [11] -0.007869344  2.402948928  0.017237933  0.012381977  1.997416842
## [16]  1.594240731  0.300665389  0.306091374  0.307418652  0.412927392
## [21]  1.984758993  0.016614318 -0.009860736 -0.003755057 -0.009486864
## [26] -0.007199297 -0.010345956  0.001497908  0.008719189  0.001515699
## [31] -0.019308122  0.004918108  0.004116757</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># set the new parameter vector</span>
PCMBase_model_BM_drift_<span class="dv">2</span>&lt;-PCMBase_model_BM_drift
<span class="kw"><a href="../reference/PCMParamLoadOrStore.html">PCMParamLoadOrStore</a></span>(PCMBase_model_BM_drift_<span class="dv">2</span>, v_param_<span class="dv">2</span>, <span class="dt">offset =</span> <span class="dv">0</span>, <span class="dt">load=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] 33</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(PCMBase_model_BM_drift_<span class="dv">2</span>)</code></pre></div>
<pre><code>## Brownian motion model with drift
## S3 class: BM_drift, GaussianPCM, PCM; k=3; p=33; regimes: a, b. Parameters/sub-models:
## X0 (VectorParameter, _Global, numeric; trait values at the root):
## [1] 4.9885615 1.9898586 0.9849329
## h_drift (VectorParameter, matrix; drift vector modyfing the expectation):
##             a        b
## [1,] 4.011415 1.015901
## [2,] 5.010457 2.003816
## [3,] 5.987848 2.997723
## Sigma_x (MatrixParameter, _UpperTriangularWithDiagonal, _WithNonNegativeDiagonal; Cholesky factor of the unit-time variance rate):
## , , a
## 
##          [,1]         [,2]       [,3]
## [1,] 1.591957 -0.007869344 0.01723793
## [2,] 0.000000  2.402948928 0.01238198
## [3,] 0.000000  0.000000000 1.99741684
## 
## , , b
## 
##          [,1]      [,2]      [,3]
## [1,] 1.594241 0.3006654 0.3074187
## [2,] 0.000000 0.3060914 0.4129274
## [3,] 0.000000 0.0000000 1.9847590
## 
## Sigmae_x (MatrixParameter, _UpperTriangularWithDiagonal, _WithNonNegativeDiagonal; Cholesky factor of the non-heritable variance or the variance of the measurement error):
## , , a
## 
##            [,1]         [,2]         [,3]
## [1,] 0.01661432 -0.009860736 -0.009486864
## [2,] 0.00000000 -0.003755057 -0.007199297
## [3,] 0.00000000  0.000000000 -0.010345956
## 
## , , b
## 
##             [,1]        [,2]         [,3]
## [1,] 0.001497908 0.008719189 -0.019308122
## [2,] 0.000000000 0.001515699  0.004918108
## [3,] 0.000000000 0.000000000  0.004116757
## 
## </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">log_lik_from_likFun_<span class="dv">2</span>&lt;-<span class="kw">likFun</span>(v_param_<span class="dv">2</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(log_lik_from_likFun_<span class="dv">2</span>[<span class="dv">1</span>])</code></pre></div>
<pre><code>## [1] -47.9567</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#brownian-motion-with-drift">Brownian motion with drift</a></li>
      <li><a href="#a-pcmbase-class-for-brownian-motion-with-drift">A PCMBase class for Brownian motion with drift</a></li>
      <li><a href="#example-run">Example run</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Venelin Mitov.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
